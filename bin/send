function usage {
    echo "Usage: send [-m machine] dbname cmd args...]"
    exit 1
}

if [[ "$#" -eq 0 ]]; then
    usage
fi

host=$HOSTNAME
if [[ "$1" == "-m" ]]; then
    shift
    host="$1"
    shift
fi

DB=$1
shift
if [[ $DB == "pmux" ]]; then
    echo $1 | telnet $host 5105
else
    echo -e "select 'comdb2_host='||comdb2_host() as out\nexec procedure sys.cmd.send('$*')" | cdb2sql -s $DB @${host} - | sed "s/^(out='//g;s/')$//g"
fi
